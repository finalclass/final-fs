<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Final-FS by finalclass</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/finalclass/final-fs">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/finalclass/final-fs/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/finalclass/final-fs/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Final-FS</h1>
          <p>Promised wrapper for node fs module with usefull additional set of functions.</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/finalclass">finalclass</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></span>
        </div>

        <p><strong>MIT License</strong> (see LICENSE.txt)</p>

<p>Final-FS is an utility library for file system operations.
It wrapps nodejs "fs" module and provides it's functions in promise pattern.
Also it has few additional useful set of functions.
Every aynchrouns function in final-fs module uses <a href="https://github.com/cujojs/when">when</a> Promises.</p>

<p>For example, checking file existance can be done with this code:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">ffs</span> <span class="o">=</span> <span class="nx">requtheire</span><span class="p">(</span><span class="s1">'final-fs'</span><span class="p">);</span>

<span class="nx">ffs</span><span class="p">.</span><span class="nx">exists</span><span class="p">(</span><span class="s1">'somefile.txt'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'The file really exists'</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'File somefile.txt does not exists'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<h2>Installation</h2>

<pre><code>npm install final-fs
</code></pre>

<h2>Paths</h2>

<p>All paths can be specified using array notation. If an array is given as an argument the path.resolved is called.</p>

<p>For example: <code>ffs.exists(path.resolve(__dirname, 'var', 'test'))</code> is same as <code>ffs.exists([__dirname, 'var', 'test'])</code>.</p>

<h2>Chaining</h2>

<p>Final-FS uses <a href="https://github.com/cujojs/when">when</a> library for async calls so there is no worry about the callback hell.</p>

<p>For example reading a file as a json, altering json object and saving it again would look like this:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">ffs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'final-fs'</span><span class="p">),</span>
    <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">),</span>
    <span class="nx">filePath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'data.json'</span><span class="p">);</span>

<span class="nx">ffs</span><span class="p">.</span><span class="nx">exists</span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">ffs</span><span class="p">.</span><span class="nx">readJSON</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="p">{};</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">obj</span><span class="p">.</span><span class="nx">hello</span> <span class="o">=</span> <span class="s1">'World!'</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">ffs</span><span class="p">.</span><span class="nx">writeJSON</span><span class="p">(</span><span class="nx">filePath</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// file data.json is saved now</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">otherwise</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// If something on this call chain went wrong then this function will catch it</span>
    <span class="p">});</span>
</pre></div>

<p>You can even return the result and chain further in another function. Look at the source code of rmdirRecursive function
to see how easy it is to work aysnchronous with files using Final-FS and <a href="https://github.com/cujojs/when">when</a> library.</p>

<h2>Additional functions provided with final-fs</h2>

<h3>rmdirRecursiveSync(dirPath:string) : void</h3>

<p>Recusrise remove all directory contents. Synchronous version</p>

<h6>Example: Remove ./tmp folder with it's contents.</h6>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">ffs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'final-fs'</span><span class="p">),</span>
    <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>

<span class="nx">ffs</span><span class="p">.</span><span class="nx">rmdirRecursiveSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'tmp'</span><span class="p">));</span>
<span class="c1">// directory ./tmp is removed now</span>
</pre></div>

<h3>rmdirRecursive(dirPath:string) : Promise</h3>

<p>Recursively remove directory. Asynchronous version</p>

<h6>Example: Remove ./tmp folder with it's contents</h6>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">ffs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'final-fs'</span><span class="p">)</span>
    <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>

<span class="nx">ffs</span><span class="p">.</span><span class="nx">rmdirRecursive</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'tmp'</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// directory ./tmp is removed now</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">otherwise</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// something went wrong</span>
    <span class="p">});;</span>
</pre></div>

<h3>writeJSON(filePath:string, obj:Object) : Promise</h3>

<p>Convert obj into json string and write it to the file in the filePath</p>

<h6>Example: Insert object into ./data.json file</h6>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">ffs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'final-fs'</span><span class="p">)</span>
    <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">),</span>
    <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span><span class="nx">foo</span><span class="o">:</span> <span class="s1">'bar'</span><span class="p">}</span>
    <span class="nx">filePath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'data.json'</span><span class="p">);</span>

<span class="nx">ffs</span><span class="p">.</span><span class="nx">writeJSON</span><span class="p">(</span><span class="nx">filePath</span><span class="p">,</span> <span class="nx">obj</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// file data.json is written now</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">otherwise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// something went wrong. See err for details</span>
    <span class="p">});</span>
</pre></div>

<h3>readJSON(filePath:string) : Promise</h3>

<p>Read file content and turn it into js object</p>

<h6>Example: read file ./data.json and convert it into a js object.</h6>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">ffs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'final-fs'</span><span class="p">),</span>
    <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">),</span>
    <span class="nx">filePath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'data.json'</span><span class="p">);</span>

<span class="nx">ffs</span><span class="p">.</span><span class="nx">readJSON</span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// obj is now an object build from data.json file content</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">otherwise</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// something went wrong. See err for details</span>
    <span class="p">});</span>
</pre></div>

<h3>dirInfo(dirPath:string) : Promise</h3>

<p>Returns an array of fs.Stat objects with additional filePath and fileName properties</p>

<h6>Example</h6>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">ffs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'final-fs'</span><span class="p">),</span>
    <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">),</span>
    <span class="nx">dirPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'var'</span><span class="p">);</span>

<span class="nx">ffs</span><span class="p">.</span><span class="nx">dirInfo</span><span class="p">(</span><span class="nx">dirPath</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">stats</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// stats is an array of fs.Stats objects with fileName and filePath properties</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">otherwise</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// error</span>
    <span class="p">});</span>
</pre></div>

<h3>dirFiles(dirPath:string) : Promise</h3>

<p>Returns all the files from the directory.</p>

<h6>Example</h6>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">ffs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'final-fs'</span><span class="p">),</span>
    <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">),</span>
    <span class="nx">dirPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'var'</span><span class="p">);</span>

<span class="nx">ffs</span><span class="p">.</span><span class="nx">dirFiles</span><span class="p">(</span><span class="nx">dirPath</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filesOnly</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// filesOnly is an array of directory files names</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">otherwise</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// error</span>
    <span class="p">});</span>
</pre></div>

<h3>fileNameFilter(text:string) : string</h3>

<p>Returns provided <code>text</code> as a file name valid string.</p>

<h6>Example</h6>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">ffs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'final-fs'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">fileName</span> <span class="o">=</span> <span class="nx">ffs</span><span class="p">.</span><span class="nx">fileNameFilter</span><span class="p">(</span><span class="s1">'an Inv@lid t$xt'</span><span class="p">);</span>
<span class="c1">// fileName is now: "an-invlid-txt"</span>
</pre></div>

<h2>Node-fs module port</h2>

<p>Final-FS uses <a href="https://github.com/bpedro/node-fs">nodefs</a> module.
This module provides 2 functions:</p>

<ul>
<li>mkdir</li>
<li>mkdirSync</li>
</ul><p>Final-FS uses these 2 functions and wrappes mkdir asynchrouns function with a promise. It also changes their names:</p>

<ul>
<li>mkdir becomes <code>mkdirRecursive</code>
</li>
<li>mkdirSync becomes <code>mkdirRecursiveSync</code>
</li>
</ul><h3>mkdirRecursiveSync(path:string, ?mode:number=0777) : void</h3>

<p>Synchronously creates a directory recursively.</p>

<h6>Exmaple. Create directory ./var/tmp/tmp2, when directory ./var does not exists</h6>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">ffs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'final-fs'</span><span class="p">),</span>
    <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">),</span>
    <span class="nx">dirPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'var'</span><span class="p">,</span> <span class="s1">'tmp'</span><span class="p">,</span> <span class="s1">'tmp2'</span><span class="p">);</span>

<span class="nx">ffs</span><span class="p">.</span><span class="nx">mkdirRecursiveSync</span><span class="p">(</span><span class="nx">dirPath</span><span class="p">);</span>
<span class="c1">// now ./var/tmp/tmp2 directory is created</span>
</pre></div>

<h3>mkdirRecursive(path:string, ?mode:number=0777) : Promise</h3>

<p>Asynchronously creates a directory recursively.</p>

<h6>Exmaple. Create directory ./var/tmp/tmp2, when directory ./var does not exists</h6>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">ffs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'final-fs'</span><span class="p">),</span>
    <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">),</span>
    <span class="nx">dirPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'var'</span><span class="p">,</span> <span class="s1">'tmp'</span><span class="p">,</span> <span class="s1">'tmp2'</span><span class="p">);</span>

<span class="nx">ffs</span><span class="p">.</span><span class="nx">mkdirRecursiveSync</span><span class="p">(</span><span class="nx">dirPath</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// now ./var/tmp/tmp2 directory is created</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">otherwise</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// something went wrong</span>
    <span class="p">});</span>
</pre></div>

<h2>Nodejs fs module functions</h2>

<p>These functions work exatcly the same as in nodejs fs module However asynchrouns functions doesn't take any callbacks.
  Instead a Promise is returned.</p>

<p>The rule is simple:</p>

<ul>
<li>If callback tooked 2 arguments then error argument would be available in <code>otherwise</code> function and
the secound argument will be available in <code>then</code> function.</li>
<li>If only one argument is provided and it's an error then <code>otherwise</code> function would have this argument as it's own.</li>
<li>If only one argument is provided for the callback and it's not an error (for example the result of fs.exists function)
then this argument would be an argument for <code>then</code> function.</li>
</ul><p>Ported functions are:</p>

<pre><code>rename(string, string) : Promise
renameSync(string, string) : void
ftruncate(number, number) : Promise
ftruncateSync(number, number) : void
truncate(string, number) : Promise
truncateSync(string, number) : void
chown(string, number, number) : Promise
chownSync(string, number, number) : void
fchown(number, number, number) : Promise
fchownSync(number, number, number) : void
lchown(string, number, number) : Promise
lchownSync(string, number, number) : void
chmod(string, number) : Promise
chmodSync(string, number) : Promise
fchmod(number, number) : Promise
fchmodSync(number, number) : void
lchmod(string, number) : Promise
lchmodSync(string, number) : void
stat(string) : Promise
lstat(string) : Promise
fstat(string) : Promise
statSync(string) : fs.Stats
lstatSync(string) : fs.Stats
fstatSync(string) : fs.Stats
link(string, string) : Promise
linkSync(string, string) : void
symlink(string, string, ?'dir'|'file'|'junction'='file') : Promise
symlinkSync(string, string, ?'dir'|'file'|'junction'='file') : void
readlink(string) : Promise
readlinkSync(string) : string
realpath(string, ?object=) : Promise
realpathSync(string, ?object=) : string
unlink(string) : Promise
unlinkSync(string) : void
rmdir(string) : Promise
rmdirSync(string) : void
mkdir(string, ?number=0777) : Promise
mkdirSync(string, ?number=0777) : void
readdir(string) : Promise
readdirSync(string) : string[]
close(number) : Promise
closeSync(number) : void
open(string, string, ?number=0666) : Promise
openSync(string, string, ?number=0666) : void
utimes(string, number, number) : Promise
utimesSync(string, number, number) : void
futimes(number, number, number) : Promise
futimesSync(number, number, number) : void
fsync(number) : Promise
fsyncSync(number) : void
write(number, Buffer, number, number, nbumber) : Promise
writeSync(number, Buffer, number, number, nbumber) : number
read(number, Buffer, number, number, number) : Promise
readSync(number, Buffer, number, number, number) : number
readFile(string, ?{?encoding:string=null, ?flag:string=r}=) : Promise
readFileSync(string, ?{?encoding:string, ?flag:string}=) : Buffer|string
writeFile(string, string|Buffer, ?{?encoding:string, ?mode:number, ?flag:string}=) : Promise
writeFileSync(string, string|Buffer, ?{?encoding:string, ?mode:number, ?flag:string}=) : void
appendFile(string, string|Buffer, ?{?encoding:string, ?mode:number, ?flag:string}=) : Promise
appendFileSync(string, string|Buffer, ?{?encoding:string, ?mode:number, ?flag:string}=) : void
watchFile(string, ?{persistent:boolean, interval:number}=, ?function(fs.Stats, fs.Stats)=) : void
unwatchFile(string, function(fs.Stats, fs.Stats)) : void
watch(string, ?{persistent:boolean, interval:number}=, ?function (string, string)) : fs.FSWatcher
exists(string) : Promise
existsSync(string) : boolean
createReadStream(string, ?{flags:'r', encoding: null, fd: null, mode: 0666, bufferSize: 66020, autoClose: true}) : ReadStream
createWriteStream(string, ?{flags: 'w', encoding: null, mode: 0666}=) : WriteStream
</code></pre>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>